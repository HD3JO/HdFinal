<!DOCTYPE HTML>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.w3.org/1999/xhtml"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

<head>
<title>한섬 커뮤니티 Sommunity</title>
<meta charset="utf-8" />
<meta name="_csrf" th:content="${_csrf.token}">
<meta name="_csrf_header" th:content="${_csrf.headerName}">
<meta name="viewport"
	content="width=device-width, initial-scale=1, user-scalable=no" />
<link rel="stylesheet" href="/sommunity/assets/css/_style_webzine.css" />
<link rel="stylesheet" href="/sommunity/assets/css/_style_webzine2.css" />
<link rel="stylesheet" href="/sommunity/assets/css/_style_gallery.css" />
<link rel="stylesheet" href="/sommunity/assets/css/board.css" />
<link rel="stylesheet" href="/sommunity/assets/css/_style_list.css" />
<link rel="stylesheet" href="/sommunity/assets/css/css3.css" />
<link rel="stylesheet" href="/sommunity/assets/css/dark.css" />
<link rel="stylesheet" href="/sommunity/assets/css/view_document.css" />
<link rel="stylesheet"
	href="/sommunity/assets/css/fontawesome-all.min.css" />
<link rel="stylesheet" href="/sommunity/assets/css/main.css" />
<link rel="stylesheet" href="/sommunity/assets/css/button.css" />
<link rel="stylesheet" href="/sommunity/assets/css/responsive-grid.css" />
<link rel="stylesheet" href="/sommunity/assets/css/themify-icons.css" />
<link rel="stylesheet" href="/sommunity/assets/css/view_document.css" />
<link rel="stylesheet" href="/sommunity/assets/css/write_form.css" />

<!-- Scripts -->
<script src="/sommunity/assets/js/jquery.min.js"></script>
<script src="/sommunity/assets/js/browser.min.js"></script>
<script src="/sommunity/assets/js/breakpoints.min.js"></script>
<script src="/sommunity/assets/js/util.js"></script>
<script src="/sommunity/assets/js/main.js"></script>
<script src="/sommunity/assets/js/board.js"></script>
<script src="/sommunity/assets/js/jquery.plugins.min.js"></script>
<script src="/sommunity/assets/js/jquery.plugins.min.js"></script>
<script type="text/javascript" src="/smarteditor/js/HuskyEZCreator.js" charset="utf-8"></script>

<noscript>
	<link rel="stylesheet" href="/sommunity/assets/css/noscript.css" />
</noscript>
</head>

<body class="is-preload">
	<!-- Wrapper -->
	<div id="wrapper">
		<!-- Header -->
		<header id="header">
			<div class="inner">

				<!-- Logo -->
				<a href="/sommunity/home" class="logo"> <span class="symbol"><img
						src="images/sommunity.png" style="margin: 0 auto;" alt="" /></span><span
					class="title"></span>
				</a>
				<!-- Nav -->
				<nav>
					<ul>
						<li><a href="#menu">Menu</a></li>
					</ul>
				</nav>
				<div class="mg-b30 text-center" style="text-align : center;">
					<h1 class="text-center" th:text="${#strings.toUpperCase(bname)} + ' 게시판 글쓰기'"></h1>
					<h2 id="contextPathHolder" th:text="${#httpServletRequest.getContextPath()}"/>
				</div>
			</div>
		</header>

		<!-- Menu -->
		<nav id="menu">
			<h2>Menu</h2>
			<ul>
				<li><a href="/sommunity/home">Home</a></li>
				<li><a href="/customLogin">로그인</a></li>
				<li><a href="/customLogin">회원가입</a></li>
				<li><a href="elements.html">마이페이지</a></li>
			</ul>
		</nav>

		<!-- Main -->
		<div class="main">
			<div class="inner">
	            <div class="xet_content">
				<div class="xet_content">
					<script>
						var default_style = 'list';
						var doc_img = 'Y';
					</script>
	
					<div id="xet-boardWrp" class="light">
						<div class="mg-b15">
							<button type="button" id="cancelButton"
								th:attr="onclick=|goBoard('${bname}')|"
								class="xet_btn medium white"> 취소
							</button>
						</div>
						<script type="text/javascript">
							function goBoard(bname) {
								location.href = '/sommunity/board?bname='+bname;
							}
						</script>
						<form action="/sommunity/writeComplete" method="POST" id="boardForm" class="boardWrite">
						<!--  brand v, bheader, btitle, bcontent v, bauthor -->
							<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
							<input type="hidden" name="bauthor" id="bauthor" th:value="${#authentication.name}" >
							<input type="hidden" name="brand" id="brand" th:value=${bname}>
							<div class="boardEditor">
								<div class="boardWriteHeader">
									<!-- 
									<div class="write_type">
										<div class="input_form">
											<input type="text" class="inputText" title="제목" th:value="${bname} + ' 게시판'"
												onfocus="if(this.value==this.title) this.value='';" disabled>
										</div>
									</div>
									-->
									<div class="write_type"> 
										<select id="bheader"name="bheader" required>
	                                        <option value="" style="display : none;" selected>머리글 선택</option>
	                                        <option value="[잡담]">[잡담]</option>
	                                        <option value="[구매후기]">[구매후기]</option>
	                                        <option value="[정보]">[정보]</option>
	                                    </select> 
									</div>
									<div class="write_type">
										<div class="input_form">
											<!-- 제목 기본내용 입력 -->
											<input type="text" name="btitle" id="btitle"
												class="inputText" title="제목" value="" 
												onfocus="if(this.value==this.title) this.value='';"
												placeholder="제목" required>
										</div>
									</div>
								</div>
	
								<div class="editor">
									<!-- css -->
									<!-- JS -->
									<!--#JSPLUGIN:ckeditor-->
									<div id="ckeditor_instance_19" data-editor-sequence="19"
										data-editor-primary-key-name="document_srl"
										data-editor-content-key-name="content"
										style="height: auto; background-color: #fff;">

								      <textarea id="bcontent" name="bcontent" rows="10" cols="100" style="width: 100%;"></textarea>
								      
										<script>
										let oEditors = []
										
										smartEditor = function() {
										  console.log("Naver SmartEditor")
										  nhn.husky.EZCreator.createInIFrame({
										    oAppRef: oEditors,
										    elPlaceHolder: "bcontent",
										    sSkinURI: "/smarteditor/SmartEditor2Skin.html",
										    fCreator: "createSEditor2"
										  })
										}
										
										$(document).ready(function() {
										  smartEditor()
										})
										</script> 								      
									</div>

									<!--#JSPLUGIN:jquery.fileupload-->
									<!--#JSPLUGIN:jquery.finderSelect-->
									<!--#JSPLUGIN:handlebars-->
									<div id="xefu-container-19" class="xefu-container xe-clearfix"
										data-editor-sequence="19">
	
										<div class="xefu-dropzone">
											<span class="xefu-btn fileinput-button xefu-act-selectfile">
												<span><i class="xi-icon xi-file-add"></i> 파일 첨부</span> <input
												id="xe-fileupload" type="file" class="fileupload-processing "
												value="파일 첨부" name="Filedata" data-auto-upload="true"
												data-editor-sequence="19" multiple="">
											</span>
											
											<p class="upload_info">
												
											</p>
											<p class="xefu-progress-status" style="display: none;">
												파일 업로드 중... (<span class="xefu-progress-percent">0%</span>)
											</p>
											<div class="xefu-progressbar" style="display: none;">
												<div></div>
											</div>
										</div>
	
										<div class="xefu-controll xe-clearfix" style="display: none;">
											<div style="float: left;">
												<span class="file_count">0</span>개 첨부 됨 (<span
													class="attached_size">0Byte</span> / <span
													class="allowed_attach_size">2.00MB</span>)
											</div>
											<div style="float: right">
												<input type="button" class="xefu-btn xefu-act-link-selected"
													style="vertical-align: middle; vertical-align: middle;"
													value="본문 삽입"> <input type="button"
													class="xefu-btn xefu-act-delete-selected"
													style="vertical-align: middle; vertical-align: middle;"
													value="선택 삭제">
											</div>
										</div>
										<div class="xefu-list" style="display: none;">
											<div class="xefu-list-images">
												<ul>
												</ul>
											</div>
											<div class="xefu-list-files">
												<ul>
												</ul>
											</div>
										</div>
									</div>
									<script>
										jQuery(function($) {
											// uploader
											var setting = {
												maxFileSize : 2097152,
												limitMultiFileUploadSize : 2097152
											};
											var uploader = $('#xefu-container-19')
													.xeUploader(setting);
											window.xe.msg_exceeds_limit_size = '허용된 용량을 초과하여 첨부가 되지 않았습니다.';
											window.xe.msg_checked_file_is_deleted = '%d개의 첨부 파일이 삭제되었습니다.';
											window.xe.msg_file_cart_is_null = '삭제할 파일을 선택해주세요.';
											window.xe.msg_checked_file_is_deleted = '%d개의 첨부 파일이 삭제되었습니다.';
											window.xe.msg_not_allowed_filetype = '업로드할 수 없는 파일 형식입니다.';
											window.xe.msg_file_upload_error = '파일 업로드 중 에러가 발생하였습니다.';
										});
									</script>
									
								</div>
	
								<div class="boardNavigation">
									<button type="button" class="xet_btn large submit xet_btn_block" onclick="changeQueryString(this)">등록</button>
									<div class="mg-t10">
										<button type="button" onclick="doDocumentSave(this);"
											class="xet_btn medium white">  임시 저장 </button>
										<script>
										
										function checkForm(){
											console.log('checkForm called');
											let btitle = document.querySelector("#btitle").value;
											let bheader = document.querySelector("#bheader").value;
											let bcontent = document.querySelector("#bcontent").value;
											let checkFormFlag = true;
											
											if(bheader === ''|| bheader == undefined){
												alert('머릿글을 선택해주세요.');
												checkFormFlag = false;
											}else if(btitle === '' || btitle == undefined){
												alert('제목을 입력해주세요.');
												checkFormFlag = false;
											}else if(bcontent == '<p>&nbsp;</p>' || bcontent === '' || bcontent === undefined){
												alert('입력된 내용이 없습니다. ');
												checkFormFlag = false;
											}
											return checkFormFlag;
										}
										
										
										
										function changeQueryString(obj){
											oEditors.getById["bcontent"].exec("UPDATE_CONTENTS_FIELD", []); //스마트 에디터 값을 텍스트컨텐츠로 전달  
											
											String.prototype.decodeEntity = function() {     return this.replace(/&/gi, "&").replace(/</gi, "<").replace(/>/gi, ">"); };
											
											if(checkForm()){
												var action = document.querySelector("#boardForm");
												console.log(action)
												action.submit();
											}
										}

										function doDocumentSave() {
											
											let bheader = $('#bheader').val();
											let btitle = $('#btitle').val();
											//textarea 값 불러옴
											oEditors.getById["bcontent"].exec("UPDATE_CONTENTS_FIELD", [])
											let bcontent = document.getElementById("bcontent").value;
											if(bcontent == '<p>&nbsp;</p>' || bcontent == '') {
												console.log('내용 빔');
											    return;
											 }else {
												console.log(bheader);
												console.log(btitle);
												console.log(bcontent);
											 }
										}
										</script>
									</div>
	
								</div>
							</div>
						</form>
						<!-- // 하단 내용 // -->
					</div>
					<!-- board End -->
					<!-- // 게시판 끝 // -->
				</div>
			</div>
		</div>
	</div>

	<!-- Footer -->
	<footer id="footer">
		<div class="inner">
			<section>
				<h2>Follow</h2>
				<ul class="icons">
					<li><a href="https://www.facebook.com/thehandsome.official/"
						class="icon brands style2 fa-facebook-f"><span class="label">Facebook</span></a></li>
					<li><a href="https://www.instagram.com/thehandsome_official/"
						class="icon brands style2 fa-instagram"><span class="label">Instagram</span></a></li>
					<li><a href="#" class="icon solid style2 fa-phone"><span
							class="label">Phone</span></a></li>
					<li><a href="#" class="icon solid style2 fa-envelope"><span
							class="label">Email</span></a></li>
				</ul>
			</section>
			<ul class="copyright">
				<li>&copy; Untitled. All rights reserved</li>
				<li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
			</ul>
		</div>
	</footer>

	</div>

</body>

</html>